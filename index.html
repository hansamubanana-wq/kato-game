<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Survival in Math Class</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            text-align: center;
            background-color: #2b4528; /* é»’æ¿è‰² */
            color: white;
            margin: 0;
            overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¦æ­¢ */
            touch-action: manipulation; /* ã‚¹ãƒãƒ›ã§ã®é…å»¶å¯¾ç­– */
            user-select: none; /* ãƒ†ã‚­ã‚¹ãƒˆé¸æŠç¦æ­¢ */
            -webkit-user-select: none;
        }

        /* é»’æ¿ã‚¨ãƒªã‚¢ */
        #blackboard {
            border: 10px solid #8b5a2b;
            margin: 10px;
            height: 40vh;
            position: relative;
            background-image: linear-gradient(#2b4528, #1a2e18);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        /* å…ˆç”Ÿã®è¦‹ãŸç›® */
        #teacher {
            font-size: 80px;
            transition: transform 0.2s;
            cursor: pointer;
        }
        .writing { transform: scaleX(-1); } /* èƒŒä¸­ */
        .looking { transform: scaleX(1); } /* ã“ã£ã¡è¦‹ã¦ã‚‹ */
        
        /* å¹ãå‡ºã— */
        #speech-bubble {
            background: white;
            color: black;
            padding: 5px 10px;
            border-radius: 10px;
            position: absolute;
            top: 20px;
            font-weight: bold;
            display: none;
        }

        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢ */
        #player-area {
            height: 50vh;
            background-color: #f0f0f0;
            color: #333;
            padding-top: 20px;
            position: relative;
        }

        #status { font-size: 60px; margin-bottom: 10px; }
        #score-display { font-size: 24px; font-weight: bold; }
        #level-display { font-size: 14px; color: #666; }

        /* ã‚¹ãƒãƒ›ç”¨ãƒœã‚¿ãƒ³ï¼ˆç”»é¢å…¨ä½“ã‚’ãƒœã‚¿ãƒ³åŒ–ã™ã‚‹é€æ˜ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰ */
        #touch-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10;
        }

        /* ç·Šæ€¥å›é¿ãƒœã‚¿ãƒ³ */
        #boss-key {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: red;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 12px;
            border-radius: 5px;
            z-index: 20;
            cursor: pointer;
        }

        /* å½è£…ç”»é¢ï¼ˆæœ€åˆã¯éš ã‚Œã¦ã„ã‚‹ï¼‰ */
        #fake-screen {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            color: black;
            z-index: 100;
            text-align: left;
            padding: 20px;
            box-sizing: border-box;
            font-family: serif;
        }
    </style>
</head>
<body>

    <div id="blackboard">
        <div id="speech-bubble">...</div>
        <div id="teacher">ğŸ‘¨â€ğŸ«</div>
        <div style="margin-top:10px; color:#ddd; font-size:12px;">åŠ è—¤å…ˆç”Ÿ (æ•°å­¦)</div>
    </div>

    <div id="player-area">
        <div id="status">ğŸ˜</div>
        <div id="score-display">ç¡çœ æ™‚é–“: 0.0ç§’</div>
        <div id="level-display">Level 1</div>
        <p style="font-size:12px; margin-top:20px;">PC:ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ / ã‚¹ãƒãƒ›:ç”»é¢é•·æŠ¼ã—<br>ã§å¯ã‚‹ï¼</p>
        
        <div id="touch-layer"></div>
    </div>

    <button id="boss-key">ç·Šæ€¥å›é¿ï¼</button>

    <div id="fake-screen">
        <h3>2æ¬¡é–¢æ•°ã®æœ€å¤§ãƒ»æœ€å°</h3>
        <p>é–¢æ•° y = ax^2 + bx + c ã®ã‚°ãƒ©ãƒ•ã«ãŠã„ã¦...</p>
        <p>é ‚ç‚¹ã®åº§æ¨™ã¯ (-b/2a, -(b^2-4ac)/4a) ã§ã‚ã‚Š...</p>
        <hr>
        <p style="color:gray; font-size:10px;">(ç”»é¢ã‚’ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã—ã¦å¾©å¸°)</p>
    </div>

    <script>
        const teacherEl = document.getElementById("teacher");
        const bubbleEl = document.getElementById("speech-bubble");
        const statusEl = document.getElementById("status");
        const scoreEl = document.getElementById("score-display");
        const levelEl = document.getElementById("level-display");
        const fakeScreen = document.getElementById("fake-screen");
        
        let isSleeping = false;
        let isTeacherLooking = false;
        let score = 0;
        let level = 1;
        let gameOver = false;
        let teacherTimer;
        
        // å…ˆç”Ÿã®çŠ¶æ…‹ç®¡ç†
        function updateTeacher() {
            if (gameOver) return;

            // ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦å¾…ã¡æ™‚é–“ã‚’çŸ­ç¸®
            let difficulty = Math.max(500, 3000 - (level * 200)); 
            let waitTime = Math.random() * difficulty + 1000;

            teacherTimer = setTimeout(() => {
                // 20%ã®ç¢ºç‡ã§ãƒ•ã‚§ã‚¤ãƒ³ãƒˆï¼ˆã™ãæˆ»ã‚‹ï¼‰
                const isFeint = Math.random() < 0.2;
                
                // äºˆå…†
                bubbleEl.style.display = "block";
                bubbleEl.textContent = "ã‚“ï¼Ÿ";

                setTimeout(() => {
                    // æŒ¯ã‚Šè¿”ã‚‹
                    teacherEl.classList.remove("writing");
                    teacherEl.classList.add("looking");
                    teacherEl.textContent = "ğŸ˜ "; // æ€’ã‚Šé¡”
                    isTeacherLooking = true;
                    bubbleEl.style.display = "none";

                    // åˆ¤å®šæ™‚é–“ï¼ˆãƒ•ã‚§ã‚¤ãƒ³ãƒˆãªã‚‰çŸ­ãã€é€šå¸¸ãªã‚‰1ã€œ2ç§’ï¼‰
                    const lookTime = isFeint ? 300 : (Math.random() * 1000 + 800);

                    setTimeout(() => {
                        // é»’æ¿ã«æˆ»ã‚‹
                        isTeacherLooking = false;
                        teacherEl.classList.remove("looking");
                        teacherEl.classList.add("writing");
                        teacherEl.textContent = "ğŸ‘¨â€ğŸ«";
                        
                        // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—åˆ¤å®š
                        if(score > level * 50) {
                            level++;
                            levelEl.textContent = "Level " + level + " (å…ˆç”Ÿã®åå¿œé€Ÿåº¦UP)";
                        }

                        updateTeacher(); // ãƒ«ãƒ¼ãƒ—
                    }, lookTime);

                }, 500); // äºˆå…†ã‹ã‚‰æŒ¯ã‚Šè¿”ã‚‹ã¾ã§ã®æ™‚é–“

            }, waitTime);
        }

        // åˆæœŸåŒ–
        teacherEl.classList.add("writing");
        updateTeacher();

        // ç¡çœ ãƒ«ãƒ¼ãƒ—
        setInterval(() => {
            if (gameOver) return;

            if (isSleeping) {
                // å¯ã¦ã„ã‚‹é–“ã‚¹ã‚³ã‚¢åŠ ç®—
                score += 1;
                scoreEl.textContent = "ç¡çœ æ™‚é–“: " + (score / 10).toFixed(1) + "ç§’";
                
                // å…ˆç”ŸãŒè¦‹ã¦ã„ã‚‹ã®ã«å¯ã¦ã„ãŸã‚‰ã‚¢ã‚¦ãƒˆ
                if (isTeacherLooking) {
                    endGame();
                }
            }
        }, 100);

        function endGame() {
            gameOver = true;
            statusEl.textContent = "ğŸ˜±";
            teacherEl.textContent = "ğŸ‘¹"; // é¬¼ã®å½¢ç›¸
            bubbleEl.style.display = "block";
            bubbleEl.textContent = "å»Šä¸‹ã«ç«‹ã£ã¦ã‚ï¼";
            document.body.style.backgroundColor = "#500000"; // èƒŒæ™¯èµ¤ã
            alert("ãƒãƒ¬ãŸï¼ è¨˜éŒ²: " + (score / 10).toFixed(1) + "ç§’");
            location.reload();
        }

        // å…¥åŠ›æ“ä½œï¼ˆPCã¨ã‚¹ãƒãƒ›å…±é€šï¼‰
        const startSleep = () => {
            if (!gameOver) {
                isSleeping = true;
                statusEl.textContent = "ğŸ˜´"; // å¯é¡”
                document.body.style.opacity = "0.8"; // è¦–ç•ŒãŒæš—ããªã‚‹æ¼”å‡º
            }
        };

        const stopSleep = () => {
            isSleeping = false;
            statusEl.textContent = "ğŸ˜"; // çœŸé¡”
            document.body.style.opacity = "1";
        };

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        const touchLayer = document.getElementById("touch-layer");
        
        // ã‚¹ãƒãƒ›ç”¨
        touchLayer.addEventListener("touchstart", (e) => { e.preventDefault(); startSleep(); });
        touchLayer.addEventListener("touchend", (e) => { e.preventDefault(); stopSleep(); });

        // PCç”¨
        document.addEventListener("keydown", (e) => { if (e.code === "Space") startSleep(); });
        document.addEventListener("keyup", (e) => { if (e.code === "Space") stopSleep(); });

        // ç·Šæ€¥å›é¿æ©Ÿèƒ½
        document.getElementById("boss-key").addEventListener("click", () => {
            fakeScreen.style.display = "block";
            gameOver = true; // ã‚²ãƒ¼ãƒ ã¯ä¸€æ™‚åœæ­¢ï¼ˆã¨ã„ã†ã‹çµ‚äº†æ‰±ã„ã§å®‰å…¨ç¢ºä¿ï¼‰
            clearTimeout(teacherTimer);
        });

        // å½è£…è§£é™¤ï¼ˆãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ï¼‰
        let lastTap = 0;
        fakeScreen.addEventListener("click", (e) => {
            const currentTime = new Date().getTime();
            const tapLength = currentTime - lastTap;
            if (tapLength < 500 && tapLength > 0) {
                location.reload(); // ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚²ãƒ¼ãƒ å†é–‹
            }
            lastTap = currentTime;
        });

    </script>
</body>
</html>