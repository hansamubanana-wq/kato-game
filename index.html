<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>激闘！加藤先生の授業 RPG</title>
    
    <link rel="icon" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="manifest" href="manifest.json">

    <meta property="og:title" content="激闘！加藤先生の授業 RPG">
    <meta property="og:description" content="先生の能力を奪って進め！新感覚・居眠りバトルRPG。">
    <meta property="og:image" content="https://kato-game-1.onrender.com/icon.png">
    <meta name="twitter:card" content="summary_large_image">

    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=New+Tegomin&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="name-screen" class="screen">
        <h1 class="modal-title">ENTER NAME</h1>
        <input type="text" id="player-name-input" placeholder="YOUR NAME" maxlength="8">
        <button class="btn" onclick="submitName()">OK</button>
    </div>

    <div id="menu-screen" class="screen hidden">
        <h1 id="game-title">BATTLE SELECT</h1>
        <button id="config-btn" onclick="openConfig()">⚙️</button>
        <p id="cheat-msg">GOD MODE!</p>

        <div id="face-off-area">
            <div id="arrow-left" class="select-arrow" onclick="changeStage(-1)">◀</div>
            <div id="arrow-right" class="select-arrow" onclick="changeStage(1)">▶</div>

            <div id="menu-player" class="char-box"><div class="sprite student-awake"></div><div class="char-label">YOU</div></div>
            <div class="vs-text" style="font-size:30px; color:#ff4444; font-weight:bold; text-shadow:2px 2px 0 #000;">VS</div>
            <div id="menu-rival" class="char-box">
                <div id="menu-rival-sprite" class="sprite"></div>
                <div id="menu-rival-name" class="char-label">???</div>
                <div id="menu-rank-display" class="menu-rank" style="display:none;"></div>
            </div>
        </div>

        <button id="start-btn" class="btn start-btn" onclick="startSequence()">BATTLE START</button>
        
        <button id="endless-btn" class="btn btn-endless" onclick="startEndless()">💀 ENDLESS</button>
        <button id="ng-plus-btn" class="btn btn-ngplus" style="display:none;" onclick="newGamePlus()">💪 NEW GAME +</button>

        <div id="equip-menu">
            <div id="current-equip">装備なし</div>
            <div class="equip-list">
                <div id="skill-kato" class="equip-item" onclick="equipSkill('kato')">⏱️</div>
                <div id="skill-matsuda" class="equip-item" onclick="equipSkill('matsuda')">❤️</div>
                <div id="skill-sugawara" class="equip-item" onclick="equipSkill('sugawara')">🎵</div>
                <div id="skill-fukumorita" class="equip-item" onclick="equipSkill('fukumorita')">👟</div>
                <div id="skill-sudo" class="equip-item" onclick="equipSkill('sudo')">📜</div>
                <div id="skill-otani" class="equip-item" onclick="equipSkill('otani')">🌸</div>
                <div id="skill-matsumura" class="equip-item" onclick="equipSkill('matsumura')">🧪</div>
                <div id="skill-aota" class="equip-item" onclick="equipSkill('aota')">🧥</div>
            </div>
            <div id="equip-desc">アイコンをタップで詳細表示</div>
        </div>
    </div>

    <div id="dialogue-screen" onclick="nextDialogue()">
        <div class="dialogue-box">
            <div id="diag-name" class="dialogue-name"></div>
            <div id="diag-text" class="dialogue-text"></div>
            <div class="dialogue-next">▼</div>
        </div>
    </div>

    <div id="tutorial-modal">
        <div class="config-box">
            <h2 class="modal-title">HOW TO PLAY</h2>
            <div class="tutorial-step">
                1. 画面長押し（PCはスペース）で<b>居眠り</b>します。<br>
                2. 先生が<b>横を向いたら（Side）</b>警戒！<br>
                3. 先生が<b>こっちを向く（Front）前</b>に指を離して起きろ！<br>
                4. 必殺技が来たら<b>PARRYボタン</b>をタップ！
            </div>
            <button class="btn" onclick="closeTutorial()">わかった！</button>
        </div>
    </div>

    <div id="config-modal">
        <div class="config-box">
            <h2 class="modal-title">SETTINGS</h2>
            <p class="modal-desc">メニュー</p>
            <div style="margin: 10px 0;">
                名前: <input type="text" id="config-name-input" placeholder="Name">
                <button class="btn small-btn" onclick="changeName()">変更</button>
            </div>
            <button class="btn help-btn" onclick="openTutorial()">❓ 遊び方を見る</button>
            <br><br>
            <button class="btn reset-btn" onclick="hardReset()">🗑️ 完全初期化<br><span style="font-size:8px">(データ全削除)</span></button>
            <button class="btn close-btn" onclick="closeConfig()">CLOSE</button>
        </div>
    </div>

    <div id="game-screen" class="screen hidden">
        <div id="time-filter"></div>
        <div id="start-overlay">START!</div>

        <button id="exit-btn" onclick="exitBattle()">↩ EXIT</button>
        
        <div id="teacher-area">
            <div id="blackboard-text"></div>
            <div id="warning-bubble">!</div>
            <div id="teacher-sprite" class="sprite"></div>
        </div>
        
        <div id="player-area">
            <div id="player-desk"></div>
            <div id="hud">
                <div id="hearts-container"></div>
                <div class="target-text">TARGET: <span id="target-score">30</span>s</div>
            </div>
            <div id="progress-container">
                <div id="progress-fill"></div>
                <div id="progress-text">0%</div>
            </div>
            <div id="student-sprite" class="sprite student-awake"></div>
            
            <div id="active-skill-btn" ontouchstart="activateActiveSkill(event)" onclick="activateActiveSkill(event)">✨</div>
            
            <div class="hold-text" style="position:absolute; bottom:10px; width:100%; text-align:center; color:#ddd; font-size:10px;">HOLD SPACE TO SLEEP</div>
        </div>
    </div>

    <div id="cutin-screen">
        <div class="cutin-vs">VS</div>
        <div id="cutin-img" class="cutin-teacher"></div>
        <div id="cutin-text" class="cutin-name"></div>
    </div>

    <div id="skill-cutin">
        <div style="text-align:center;">
            <div id="skill-name" class="skill-text"></div>
            <div id="skill-effect" class="skill-sub"></div>
        </div>
    </div>

    <div id="parry-btn" ontouchstart="attemptParry(event)" onclick="attemptParry(event)">🛡️<br>PARRY!</div>

    <div id="result-screen" class="screen hidden">
        <h1 id="result-title">FAILED</h1>
        <div id="rank-stamp" class="rank-stamp" style="display:none;"></div>
        <p id="result-msg">廊下に立ってなさい！</p>
        <button class="btn" onclick="returnToMenu()">NEXT</button>
    </div>

    <div id="ending-screen" class="screen hidden">
        <div id="certificate">
            <h2 class="cert-title">睡眠卒業証書</h2>
            <p><span id="cert-name"></span> 殿</p>
            <p class="cert-body">あなたは全ての先生の目を盗み<br>青田校長すらも乗り越え<br>完全爆睡したことを証します。</p>
            <p id="god-mode-note">※ゴッドモードの使用を検知しました。</p>
            <p class="cert-footer">2025年 睡眠委員会</p>
            <div class="cert-stamp">💮</div>
        </div>
        <div class="share-container">
            <button class="btn btn-x" onclick="shareX()">Xで自慢</button>
            <button class="btn btn-line" onclick="shareLine()">LINE</button>
            <button class="btn btn-share" onclick="shareNative()">共有/コピー</button>
        </div>
        <button class="btn" onclick="location.reload()" style="margin-top:20px;">タイトルへ戻る</button>
    </div>

    <script src="script.js"></script>
</body>
</html>