<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MATH CLASS RETRO</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #222;
            --accent-color: #5cff5c; /* ãƒ¬ãƒˆãƒ­ãªç·‘ */
            --danger-color: #ff4444;
            --text-color: #fff;
        }

        body {
            font-family: 'Press Start 2P', cursive; /* ãƒ”ã‚¯ã‚»ãƒ«ãƒ•ã‚©ãƒ³ãƒˆé©ç”¨ */
            text-align: center;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            overflow: hidden;
            touch-action: manipulation;
            user-select: none;
            image-rendering: pixelated; /* ç”»åƒã‚’ãƒ‰ãƒƒãƒˆé¢¨ã«ã™ã‚‹é­”æ³• */
        }

        /* å…±é€šã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¨­å®š */
        .screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--bg-color);
            transition: opacity 0.3s;
        }

        .hidden { display: none !important; }

        /* ã‚²ãƒ¼ãƒ ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        #game-screen { justify-content: flex-start; }

        #teacher-area {
            height: 45vh;
            width: 100%;
            border-bottom: 4px dashed var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            position: relative;
        }

        /* ãƒ‰ãƒƒãƒˆçµµé¢¨ã«è¦‹ã›ã‚‹ãŸã‚ã®å·¨å¤§çµµæ–‡å­— */
        .pixel-char {
            font-size: 120px;
            filter: contrast(1.5); /* ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã‚’ä¸Šã’ã¦ãƒ‘ã‚­ãƒƒã¨ã•ã›ã‚‹ */
        }

        #teacher {
            transition: transform 0.1s steps(2); /* ãƒ‘ãƒƒã¨åˆ‡ã‚Šæ›¿ã‚ã‚‹å‹•ã */
        }
        .writing { transform: scaleX(-1); }
        .looking { transform: scale(1.2); color: var(--danger-color); } /* è¦‹ã‚‹ã¨å°‘ã—å¤§ãããªã‚‹ */
        
        /* å…ˆç”Ÿã®ã‚»ãƒªãƒ•æ  */
        #teacher-msg {
            position: absolute;
            top: 10px;
            background: var(--text-color);
            color: var(--bg-color);
            padding: 8px;
            font-size: 12px;
            border: 2px solid var(--accent-color);
            display: none;
        }

        #player-area {
            height: 55vh;
            width: 100%;
            background-color: #333;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 30px;
            border-top: 4px solid #000;
        }

        #status-icon { font-size: 100px; margin-bottom: 20px; }
        
        /* Zzz ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚«ã‚¯ã‚«ã‚¯å‹•ãï¼‰ */
        .zzz {
            position: absolute;
            color: #5cff5c;
            font-size: 24px;
            animation: floatUpRetro 1s steps(5) forwards;
        }
        @keyframes floatUpRetro {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-80px); opacity: 0; }
        }

        #score-board { font-size: 20px; margin: 10px; color: var(--accent-color); }
        #high-score { font-size: 10px; color: #888; margin-top: 10px;}

        /* ãƒ¬ãƒˆãƒ­ãƒœã‚¿ãƒ³ */
        .btn {
            font-family: 'Press Start 2P', cursive;
            background: transparent;
            border: 4px solid var(--accent-color);
            padding: 15px 20px;
            font-size: 16px;
            color: var(--accent-color);
            cursor: pointer;
            margin-top: 30px;
            text-transform: uppercase;
        }
        .btn:active { background: var(--accent-color); color: var(--bg-color); }

        /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ */
        h1 { font-size: 24px; line-height: 1.5; color: var(--accent-color); margin-bottom: 40px; }
        .blink { animation: blinker 1s step-end infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        /* ãƒªã‚¶ãƒ«ãƒˆç”»é¢ */
        #result-screen { background: var(--danger-color); color: #000; }
        .big-score { font-size: 32px; margin: 30px 0; }
    </style>
</head>
<body>

    <div id="title-screen" class="screen">
        <h1>MATH CLASS<br>SURVIVOR</h1>
        <div class="pixel-char" style="font-size: 60px; margin: 20px;">ğŸ˜´ VS ğŸ‘¨â€ğŸ«</div>
        <p style="font-size: 10px; margin-top: 40px;">HOLD SPACE / TOUCH SCREEN</p>
        <p class="blink" style="font-size: 14px; margin-top: 20px;">PRESS START</p>
        <button class="btn" onclick="startGame()">START GAME</button>
        <p id="high-score-title" style="font-size: 10px; margin-top: 30px;">HI-SCORE: 0.0</p>
    </div>

    <div id="game-screen" class="screen hidden">
        <div id="teacher-area">
            <div id="teacher-msg">...</div>
            <div id="teacher" class="pixel-char">ğŸ‘¨â€ğŸ«</div>
        </div>

        <div id="player-area">
            <div id="status-icon" class="pixel-char">ğŸ˜</div>
            <div id="score-board">SCORE: 0.0</div>
            <div id="high-score">HI: 0.0</div>
        </div>
    </div>

    <div id="result-screen" class="screen hidden">
        <h1 style="color: #000;">GAME OVER</h1>
        <div class="pixel-char">ğŸ¤¬</div>
        <p>FOUND BY TEACHER!</p>
        <div class="big-score" id="final-score">SCORE: 0.0</div>
        <button class="btn" style="border-color: #000; color:#000;" onclick="location.reload()">RETRY</button>
    </div>

    <script>
        // è¦ç´ ã®å–å¾—
        const titleScreen = document.getElementById("title-screen");
        const gameScreen = document.getElementById("game-screen");
        const resultScreen = document.getElementById("result-screen");
        const teacherEl = document.getElementById("teacher");
        const teacherMsgEl = document.getElementById("teacher-msg");
        const statusEl = document.getElementById("status-icon");
        const scoreEl = document.getElementById("score-board");
        const highScoreEl = document.getElementById("high-score");
        const titleHighScoreEl = document.getElementById("high-score-title");
        const playerArea = document.getElementById("player-area");

        // å¤‰æ•°
        let isSleeping = false;
        let isTeacherLooking = false;
        let score = 0;
        let highScore = localStorage.getItem("katoGameRetroHighScore") || 0;
        let gameOver = false;
        let zzzInterval;

        // ãƒã‚¤ã‚¹ã‚³ã‚¢è¡¨ç¤ºæ›´æ–°
        titleHighScoreEl.textContent = "HI-SCORE: " + (highScore / 10).toFixed(1);
        highScoreEl.textContent = "HI: " + (highScore / 10).toFixed(1);

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            titleScreen.classList.add("hidden");
            gameScreen.classList.remove("hidden");
            teacherEl.classList.add("writing");
            updateTeacher();
            gameLoop();
        }

        // å…ˆç”Ÿã®AIï¼ˆãƒœã‚¤ã‚¹å‰Šé™¤ç‰ˆï¼‰
        function updateTeacher() {
            if (gameOver) return;

            let difficulty = Math.max(800, 4000 - (score * 5)); 
            let waitTime = Math.random() * difficulty + 1000;

            setTimeout(() => {
                // äºˆå…†ï¼ˆå¹ãå‡ºã—è¡¨ç¤ºï¼‰
                teacherMsgEl.style.display = "block";
                teacherMsgEl.textContent = "ã‚“?";

                setTimeout(() => {
                    // æŒ¯ã‚Šè¿”ã‚Š
                    teacherMsgEl.style.display = "none";
                    teacherEl.classList.remove("writing");
                    teacherEl.classList.add("looking");
                    teacherEl.textContent = "ğŸ˜ ";
                    isTeacherLooking = true;

                    // è¦‹ã¦ã„ã‚‹æ™‚é–“
                    setTimeout(() => {
                        if(!gameOver) {
                            isTeacherLooking = false;
                            teacherEl.classList.remove("looking");
                            teacherEl.classList.add("writing");
                            teacherEl.textContent = "ğŸ‘¨â€ğŸ«";
                            updateTeacher();
                        }
                    }, Math.random() * 1500 + 500);

                }, 600); // äºˆå…†ã®æ™‚é–“

            }, waitTime);
        }

        // ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
        function gameLoop() {
            setInterval(() => {
                if (gameOver) return;

                if (isSleeping) {
                    score++;
                    scoreEl.textContent = "SCORE: " + (score / 10).toFixed(1);
                    
                    if (isTeacherLooking) {
                        endGame();
                    }
                }
            }, 100);
        }

        // Zzzã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”Ÿæˆï¼ˆãƒ¬ãƒˆãƒ­ç‰ˆï¼‰
        function spawnZzz() {
            const zzz = document.createElement("div");
            zzz.className = "zzz";
            zzz.textContent = "Zzz";
            zzz.style.left = "50%"; 
            zzz.style.top = "10px";
            playerArea.appendChild(zzz);
            setTimeout(() => zzz.remove(), 1000);
        }

        // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼å‡¦ç†
        function endGame() {
            gameOver = true;
            if (score > highScore) {
                highScore = score;
                localStorage.setItem("katoGameRetroHighScore", highScore);
            }
            
            gameScreen.classList.add("hidden");
            resultScreen.classList.remove("hidden");
            document.getElementById("final-score").textContent = "SCORE: " + (score / 10).toFixed(1);
        }

        // æ“ä½œç³»
        const startSleep = () => {
            if (!gameOver) {
                isSleeping = true;
                statusEl.textContent = "ğŸ˜ª";
                if (!zzzInterval) zzzInterval = setInterval(spawnZzz, 400);
            }
        };

        const stopSleep = () => {
            isSleeping = false;
            statusEl.textContent = "ğŸ˜";
            if (zzzInterval) {
                clearInterval(zzzInterval);
                zzzInterval = null;
            }
        };

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        const touchLayer = document.getElementById("player-area");
        touchLayer.addEventListener("touchstart", (e) => { e.preventDefault(); startSleep(); });
        touchLayer.addEventListener("touchend", (e) => { e.preventDefault(); stopSleep(); });
        document.addEventListener("keydown", (e) => { if (e.code === "Space") startSleep(); });
        document.addEventListener("keyup", (e) => { if (e.code === "Space") stopSleep(); });

    </script>
</body>
</html>