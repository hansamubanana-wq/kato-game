<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¿€é—˜ï¼åŠ è—¤å…ˆç”Ÿã®æ•°å­¦</title>
    <style>
        body {
            font-family: 'Verdana', sans-serif;
            text-align: center;
            background-color: #222;
            color: white;
            margin: 0;
            overflow: hidden;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }

        /* å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #2b4528; /* é»’æ¿è‰² */
            transition: opacity 0.5s;
        }

        .hidden { display: none !important; }

        /* ã‚²ãƒ¼ãƒ ç”»é¢ */
        #game-screen { justify-content: flex-start; }

        #teacher-area {
            height: 40vh;
            width: 100%;
            position: relative;
            background: linear-gradient(#2b4528, #1a2e18);
            border-bottom: 5px solid #8b5a2b;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #teacher { font-size: 100px; transition: transform 0.1s; }
        .writing { transform: scaleX(-1); }
        
        #chalk-text {
            position: absolute;
            top: 20px; left: 20px;
            font-family: 'serif';
            font-size: 14px;
            color: rgba(255,255,255,0.5);
            text-align: left;
        }

        #player-area {
            height: 60vh;
            width: 100%;
            background-color: #f0f0f0;
            color: #333;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
        }

        #status-icon { font-size: 80px; z-index: 2; }
        
        /* Zzz ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .zzz {
            position: absolute;
            color: blue;
            font-weight: bold;
            font-size: 20px;
            animation: floatUp 1.5s linear forwards;
            z-index: 1;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(1.5); opacity: 0; }
        }

        #score-board { font-size: 24px; font-weight: bold; margin: 10px; }
        #high-score { font-size: 14px; color: #666; }

        /* ãƒœã‚¿ãƒ³é¡ */
        .btn {
            background: #ff9800;
            border: none;
            padding: 15px 40px;
            font-size: 24px;
            color: white;
            border-radius: 50px;
            box-shadow: 0 5px 0 #b36b00;
            cursor: pointer;
            margin-top: 20px;
        }
        .btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #b36b00; }

        #boss-key {
            position: absolute; bottom: 20px; right: 20px;
            background: red; padding: 10px; font-size: 12px;
            box-shadow: none; border-radius: 5px;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ«ãƒ»ãƒªã‚¶ãƒ«ãƒˆç”»é¢ */
        h1 { font-size: 28px; margin-bottom: 10px; text-shadow: 2px 2px 0 #000; }
        .big-score { font-size: 50px; color: yellow; font-weight: bold; }

    </style>
</head>
<body>

    <div id="title-screen" class="screen">
        <h1>æ¿€é—˜ï¼<br>åŠ è—¤å…ˆç”Ÿã®æ•°å­¦</h1>
        <div style="font-size: 60px; margin: 20px;">ğŸ˜´ vs ğŸ‘¨â€ğŸ«</div>
        <p>ç”»é¢é•·æŠ¼ã—ï¼ˆPCã¯ã‚¹ãƒšãƒ¼ã‚¹ï¼‰ã§å¯ã‚ï¼</p>
        <p id="high-score-title">è‡ªå·±ãƒ™ã‚¹ãƒˆ: 0.0ç§’</p>
        <button class="btn" onclick="startGame()">æˆæ¥­é–‹å§‹</button>
    </div>

    <div id="game-screen" class="screen hidden">
        <div id="teacher-area">
            <div id="chalk-text">
                y = axÂ² + bx + c<br>
                x = {-b Â± âˆš(bÂ² - 4ac)} / 2a
            </div>
            <div id="teacher">ğŸ‘¨â€ğŸ«</div>
        </div>

        <div id="player-area">
            <div id="status-icon">ğŸ˜</div>
            <div id="score-board">0.0 ç§’</div>
            <div id="high-score">BEST: 0.0</div>
            
            <button id="boss-key" class="btn">ç·Šæ€¥å›é¿</button>
        </div>
    </div>

    <div id="result-screen" class="screen hidden" style="background: #800000;">
        <h1>ãƒãƒ¬ãŸï¼ï¼ï¼</h1>
        <div style="font-size: 80px;">ğŸ‘¹</div>
        <p>åŠ è—¤å…ˆç”Ÿã«æ€’ã‚‰ã‚ŒãŸ...</p>
        <div class="big-score" id="final-score">0.0ç§’</div>
        <button class="btn" onclick="location.reload()">å†æŒ‘æˆ¦</button>
    </div>

    <script>
        // è¦ç´ ã®å–å¾—
        const titleScreen = document.getElementById("title-screen");
        const gameScreen = document.getElementById("game-screen");
        const resultScreen = document.getElementById("result-screen");
        const teacherEl = document.getElementById("teacher");
        const statusEl = document.getElementById("status-icon");
        const scoreEl = document.getElementById("score-board");
        const highScoreEl = document.getElementById("high-score");
        const titleHighScoreEl = document.getElementById("high-score-title");
        const playerArea = document.getElementById("player-area");

        // å¤‰æ•°
        let isSleeping = false;
        let isTeacherLooking = false;
        let score = 0;
        let highScore = localStorage.getItem("katoGameHighScore") || 0;
        let gameOver = false;
        let teacherTimer;
        let zzzInterval;

        // ãƒã‚¤ã‚¹ã‚³ã‚¢è¡¨ç¤ºæ›´æ–°
        titleHighScoreEl.textContent = "è‡ªå·±ãƒ™ã‚¹ãƒˆ: " + (highScore / 10).toFixed(1) + "ç§’";
        highScoreEl.textContent = "BEST: " + (highScore / 10).toFixed(1);

        // éŸ³å£°åˆæˆï¼ˆå…ˆç”Ÿã®å£°ï¼‰
        const synth = window.speechSynthesis;
        function speak(text) {
            if (synth.speaking) return;
            const uttr = new SpeechSynthesisUtterance(text);
            uttr.lang = "ja-JP"; // æ—¥æœ¬èª
            uttr.rate = 1.2; // æ—©å£
            uttr.pitch = 0.8; // ä½ã„å£°
            synth.speak(uttr);
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            titleScreen.classList.add("hidden");
            gameScreen.classList.remove("hidden");
            teacherEl.classList.add("writing");
            updateTeacher();
            gameLoop();
        }

        // å…ˆç”Ÿã®AI
        function updateTeacher() {
            if (gameOver) return;

            // ãƒ©ãƒ³ãƒ€ãƒ ãªæ™‚é–“ï¼ˆå¾ã€…ã«é›£ã—ããªã‚‹ï¼‰
            let difficulty = Math.max(800, 4000 - (score * 5)); 
            let waitTime = Math.random() * difficulty + 1000;

            teacherTimer = setTimeout(() => {
                // æŒ¯ã‚Šè¿”ã‚‹äºˆå…†ï¼ˆå£°ã‚’å‡ºã™ï¼‰
                speak("ãŠã„"); 

                setTimeout(() => {
                    // æŒ¯ã‚Šè¿”ã‚Š
                    teacherEl.classList.remove("writing");
                    teacherEl.textContent = "ğŸ˜ ";
                    isTeacherLooking = true;

                    // è¦‹ã¦ã„ã‚‹æ™‚é–“
                    setTimeout(() => {
                        if(!gameOver) {
                            isTeacherLooking = false;
                            teacherEl.classList.add("writing");
                            teacherEl.textContent = "ğŸ‘¨â€ğŸ«";
                            updateTeacher();
                        }
                    }, Math.random() * 1500 + 500);

                }, 400); // å£°ãŒå‡ºã¦ã‹ã‚‰æŒ¯ã‚Šè¿”ã‚‹ã¾ã§ã®ãƒ©ã‚°

            }, waitTime);
        }

        // ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
        function gameLoop() {
            setInterval(() => {
                if (gameOver) return;

                if (isSleeping) {
                    score++;
                    scoreEl.textContent = (score / 10).toFixed(1) + " ç§’";
                    
                    if (isTeacherLooking) {
                        endGame();
                    }
                }
            }, 100);
        }

        // Zzzã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”Ÿæˆ
        function spawnZzz() {
            const zzz = document.createElement("div");
            zzz.className = "zzz";
            zzz.textContent = "Zzz";
            // é ­ã®è¿‘ãã‹ã‚‰å‡ºã™
            zzz.style.left = "50%"; 
            zzz.style.top = "20px";
            playerArea.appendChild(zzz);

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚ã‚ã£ãŸã‚‰æ¶ˆã™
            setTimeout(() => zzz.remove(), 1500);
        }

        // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼å‡¦ç†
        function endGame() {
            gameOver = true;
            
            // ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°
            if (score > highScore) {
                highScore = score;
                localStorage.setItem("katoGameHighScore", highScore);
            }

            speak("ã“ã‚‰ãƒ¼ï¼å¯ã‚‹ãªãƒ¼ï¼å»Šä¸‹ã«ç«‹ã£ã¦ãªã•ã„ï¼");
            
            gameScreen.classList.add("hidden");
            resultScreen.classList.remove("hidden");
            document.getElementById("final-score").textContent = (score / 10).toFixed(1) + "ç§’";
        }

        // æ“ä½œç³»
        const startSleep = () => {
            if (!gameOver) {
                isSleeping = true;
                statusEl.textContent = "ğŸ˜ª";
                if (!zzzInterval) zzzInterval = setInterval(spawnZzz, 400);
            }
        };

        const stopSleep = () => {
            isSleeping = false;
            statusEl.textContent = "ğŸ˜";
            if (zzzInterval) {
                clearInterval(zzzInterval);
                zzzInterval = null;
            }
        };

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        const touchLayer = document.getElementById("player-area");
        touchLayer.addEventListener("touchstart", (e) => { 
            if(e.target.id !== "boss-key") { e.preventDefault(); startSleep(); }
        });
        touchLayer.addEventListener("touchend", (e) => { e.preventDefault(); stopSleep(); });

        document.addEventListener("keydown", (e) => { if (e.code === "Space") startSleep(); });
        document.addEventListener("keyup", (e) => { if (e.code === "Space") stopSleep(); });

        // ç·Šæ€¥å›é¿
        document.getElementById("boss-key").addEventListener("click", () => {
            alert("ç·Šæ€¥å›é¿ï¼ æ•°å­¦ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ãã¾ã—ãŸï¼ˆãƒ•ãƒªï¼‰");
            location.reload();
        });

    </script>
</body>
</html>